section .text
extern rust_malloc
global read_user_input

; rdi: str ptr, null terminated
read_user_input:
    mov rbx, user_memory
next_user_char:
    movsx rsi, byte [rdi]
    mov [rbx], sil
    inc rbx     ; next user memory
    inc rdi     ; next input memory
    test rsi, rsi
    jne next_user_char
    call write_to_database
    ret

write_to_database:
    mov rsi, message
    mov rdx, mes_len
    call print
    ret

; input rsi: str ptr
; input rdx: str len
print:
    push rax
    push rdi
    mov rax, 1
    mov rdi, 1
    syscall
    pop rdi
    pop rax
    ret

section .data
user_memory:
    db "00000"
message:
    db "storing username to database", 10
mes_len: equ $ - message
